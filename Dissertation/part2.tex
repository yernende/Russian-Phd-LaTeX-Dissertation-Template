\chapter{Численные методы}\label{ch:programming}

\section{Решение радиального уравнения}\label{sec:programming/numerov}
Радиальное уравнение
\begin{equation}\label{eq:radialEquation}
  \left[{
    -\frac{1}{r^2} \frac{d}{dr} \left({
      r^2 \frac{d}{dr}
    }\right) + \frac{l\left(l + 1\right)}{r^2} + V(r) - E
  }\right] R_l(E, r) = 0.\
\end{equation}

заменой
\begin{equation}\label{eq:radialFunctionChange}
  R_l(E, r) = \frac{P_{l E}(r)}{r}
\end{equation}

приводится к виду
\begin{equation}
  P_{l E}''(r)
  - \left(\frac{l \left(l + 1 \right)}{r^2} + V(r) - E\right) P_{l E}(r) = 0.
\end{equation}

Последнее может быть решено с помощью метода Нумерова. Полное описание метода можно найти в
книге~\cite{numerov}, остановимся лишь на его практической реализации.

Решение ДУ находится в виде последовательности точек. Из физических соображений, $P_{l E}(0) = 0$. Таким образом,
сразу известна первая точка решения. Вторая точка может быть задана произвольно, при этом $P_{l E}(r)$
будет найдена с точностью до постоянного множителя, который впоследствии вычисляется из условия нормировки. Если
заданы две точки, любые последующие могут быть высчитаны\cite{numerov-short} с помощью формулы
\begin{equation}
  P_{n} = \frac{(12-10f_{n-1}) P_{n-1}-f_{n-2}P_{n-2}}{f_{n}},
\end{equation}

где
\begin{equation}
f_n \equiv \left( 1 + \frac{h^2}{12}\left({\frac{l \left(l + 1 \right)}{r^2} + V(r) - E} \right) \right),
\end{equation}

а h "---шаг по аргументу функции.

Программный код, реализующий метод Нумерова, приведен в приложении~\cref{app:numerovcpp}. Для быстродействия код
написан на C++
и компилируется как динамическая библиотека, которая впоследствии может быть использована в программе на Python с
помощью библиотеки ctypes\cite{ctypes}.

Алгоритм можно упрощённо описать несколькими этапами:
\begin{enumerate}
    \item Построение интерполирующей функции для потенциала, переданного из программы на Python в виде
    последовательности точек.
    \item Решение ДУ для заданного потенциала, энергии и орбитального квантового числа методом Нумерова с малым шагом h
    "---при этом получается функция $P_{l E}(r)$, представленная большим числом точек.
    \item Построение интерполирующей функции для $P_{l E}(r)$.
    \item Интегрирование полученной интерполирующей функции, расчёт нормировочного коэффициента.
    \item Расчёт функции $R(E, r)$ как последовательности точек, согласно~\eqref{eq:radialFunctionChange}. При этом в
    первой точке получается неопределённость вида $\frac{0}{0}$, которая будет раскрыта в дальнейшем. Число точек,
    для экономии памяти и ускорения построения графиков, делается меньшим, чем изначально посчитанное "---в количестве,
    заданном программой на Python.
    \item Построение производной радиальной функции численными методами\cite{Fornberg1988GenerationOF} начиная с первой
    точки.
    \item Вычисление второй производной радиальной функции во второй точке.
    \item В допущении, что вторую производную радиальной функции при малых значениях аргумента можно считать постоянной,
    вычисление первой производной радиальной функции в нуле по формуле
    \begin{equation}
      R'_0 = R'_1 - R''_1 \tilde{h},
    \end{equation}

    где $\tilde{h}$ "---шаг по аргументу $R(E, r)$.

    \item Вычисление радиальной функции в нуле по формуле
    \begin{equation}
      R_0 = R_1 - R'_0 \tilde{h}.
    \end{equation}
\end{enumerate}

На рисунке~\ref{fig:radial-functions} приведены расчитанные таким образом радиальные функции на примере атома водорода
в различных состояниях. Потенциал при этом задаётся аналитически как
\begin{equation}
V(r) = -\frac{2}{r}.
\end{equation}

\begin{figure}[ht]
    \centerfloat{
        \ifdefmacro{\tikzsetnextfilename}{\tikzsetnextfilename{tikz_example_compiled}}{}% присваиваемое предкомпилированному pdf имя файла (не обязательно)
        \input{images/radial-functions.pgf}
    }
    \caption{Радиальные функции атома водорода в различных состояниях}\label{fig:radial-functions}
\end{figure}

Недостатком метода Нумерова является то, что его погрешность растёт при увеличении аргумента, и при большом его значении
радиальная функция может даже не сходиться к нулю. Альтернативным методом решения радиального уравнения является метод
Рунгe"--~Кутты. Для его использования необходимо переписать радиальное уравнение в виде системы обыкновенных
дифферинциальных уравнений
\begin{equation}\label{eq:RungeKuttaSolvableSystem}
  \begin{cases}
    P_{l E}'(r) = u_{l E}(r),\\
    u_{l E}'(r) = \left( \frac{l \left(l + 1 \right)}{r^2} + V(r) - E \right) P_{l E}(r).
  \end{cases}
\end{equation}

Реализация метода Рунге"--~Кутты для решения систем обыкновенных дифферинциальных уравнений есть как в библиотеке
GNU~Scientific~Library\cite{rk-gsl}, так
и в пакете SciPy\cite{rk-scipy}. Для начала решения нужно задать два начальных условия: значение $P_{l E}(r)$ в
нуле (это, как уже отмечалось, ноль), и значение производной $P_{l E}(r)$ в нуле с точностью до постоянного
множителя, выбор которого влияет лишь на нормировку полученного решения. Проблема состоит в том, что для некоторых
$P_{l E}(r)$ (например, у электрона в атоме водорода в состоянии с $E = 0.25, l = 1$) производная в нуле может быть равна
нулю, и домножение на постоянный множитель также даст ноль. Вместе с тем, при обеих нулевых начальных значениях данный
метод вернёт тривиальное решение "---нулевую функцию. Таким образом, один только метод Рунге"--~Кутты в общем случае непригоден для
решения радиального уравнения с произвольными параметрами. Однако, его можно использовать в связке с методом Нумерова,
если начинать считать не от нуля, а от некоторой следующей точки, так, чтобы хотя бы одно из начальных значений не было
нулевым (при этом все предшествующие точки должны быть посчитаны методом Нумерова). Таким образом, можно получить
радиальную функцию с лучшим поведением при большом аргументе.

Следует, однако, отметить, что при слишком большом аргументе даже в случае с решением, полученным методом Рунге"--~Кутты,
радиальная функция, уже будучи весьма близка к нулю, внезапно начинает стремиться к бесконечности, поэтому её нужно
обрезать в точке последнего минимума.

\FloatBarrier
